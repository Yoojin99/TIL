# 2. 관리

코드 정리를 개인 개발 흐름에 맞추는 방법

* 코드 정리는 언제 시작하는지
* 코드 정리는 언제 멈추는지
* 구조 변경 / 로직 변경을 어떻게 결합할 수 있는지

## 16. 코드 정리 구분

PR 을 사용하는 팀이라고 가정.

* 로직 변경 코드 + 코드 정리 PR : 너무 길다!
* 코드 정리만 담긴 PR : 무슨 의미로 만들었는지 모르겠다!

**코드 정리는 별도의 PR 로 만들고 PR 당 몇 개의 코드 정리만 넣기**

코드 정리 단계

1. 코드를 전반적으로 살펴보며 '변경을 구분하지 않은 상태에서 다수의 변경'. -> 어떤 지점을 어떻게 변경해야겠다라는 목적 없이 눈에 거슬리는 여러 지점에서의 변경
2. 코드를 자세히 보면서 초점 맞추기 -> 변경 대상들이 로직/구조 중 어떤 변경에 해당하는지 파악. (어떻게 바꿔야겠다는 계획 없이 동작/구조 다른 두 종류의 변경이 함께 존재함을 인식하고 있는 단계)
3. 코드 정리 / 흐름 파악을 통해 각 변경이 어떤 순서로 진행될 지 보임. (아직까지 한 개의 PR 에 섞여 있음)
4. 위에서 파악한 변경사항들을 나눠 별도의 PR 로 만듬. 코드 정리 / 로직 변경을 전환할때마다 새 PR 생성

PR 크기에 따른 장단점
* 큰 PR
  * 장점 : 전체 그림 파악 쉬움  
  * 단점 : 검토 입장에서는 유용한 피드백 주기 어려울 수 있음
* 작은 PR
  * 장점 : 검토 시간 단축, 소소한 피드백 가능
  * 단점 : 무시될 염려 있음

**작은 PR 은 작은 곳에 초점을 맞춰서 더 빠른 검토를 장려하고 검토 시간을 단축함.** 검토 시간이 단축되며 더 작은 PR 만들도록 동기부여가 됨. 

*책에서는 작은 코드 정리에 익숙해져서 절대적으로 안전하게 작업하는데 익숙해지면 코드 정리 PR을 따로 검토하지 않는 시도를 해보라 함. 대기 시간이 줄어들어 더 작게 PR 을 만들도록 장려하는 효과가 생김.*

* 코드 정리만 따로 pr 로 올리는 것?
* 코드 정리 PR 을 검토하는 것? 

## 17. 연쇄적인 정리

코드를 계속 정리하고 싶은 충동을 관리하는 것 또한 기술. 작은 단계로 나눠 코드를 정리하면서 각 단계를 최적화하기. 

* 코드 정리와 각 코드 정리 이후 따라 올 수 있는 코드 정리
  * 보호 구문
    * 보호 구문을 빼면 보호 조건을 helper / 설명하는 변수로 추출할 수 있음
  * 안 쓰는 코드
    * 안 쓰는 코드를 제거하면 코드를 읽는 순서에 맞춰 정렬하고 응집도를 높일 수 있는 배치 보임
  * 대칭으로 맞추기
    * 여러 곳에서 사용되는 코드를 대칭으로 맞추면 유사한 코드들이 드러남
  * 새로운 인터페이스로 기존 루틴 부르기
    * 새 인터페이스를 만들어서 기존 루틴을 부를 때 별도의 개발자 도구가 없으면 기존 루틴 호출되는 부분을 일일이 고쳐야 함. 한 곳을 고치면 뒤따라 정리되어야 하는 곳 발생
  * 읽는 순서
    * 읽는 순서를 정리하면 대칭으로 맞출 기회 생길 수 있음
  * 응집도를 높이는 배치
    * 함께 묶인 요소를 하위 요소로 추출할 수 있음
  * 설명하는 변수
    * 설명하는 변수로 불필요한 주석을 삭제할 수 있음
  * 설명하는 상수
    * 응집도를 높이는 배치를 이끔. 한 번에 바뀌는 상수를 모아서 묶어놓으면 추후 수정이 편리함
  * 명시적인 매개변수
    * 매개변수 집합을 묶어 객체로 만들 수 있음. 코드 정리를 통해 새로운 추상화 도출될 수 있음.
  * 비슷한 코드끼리
    * 코드 앞에 설명하는 주석을 붙이거나 코드 덩어리를 설명하는 도우미로 바꿀 수 있음
  * 도우미 추출
    * 보호 구문 도입, 설명하는 상수/변수 추출, 불필요한 주석 삭제
  * 하나의 더미
    * 코드가 모이면 비슷한 코드끼리 정리, 설명하는 주석 생성, 도우미 추출 가능
  * 설명하는 주석
    * 주석에 있는 정보를 설명하는 변수/상수/도우미 등으로 도입 가능
  * 불필요한 주석 지우기
    * 읽는 순서 개선, 명시적인 매개변수 사용 가능.

**코드 정리는 작고 느리게 변경**

## 18. 코드 정리의 일괄 처리량

코드 정리의 적절한 크기

* 통합/배포 전 얼마나 많은 코드 정리를 해야 하는가?
* 코드 정리의 크기가 어느 정도일 때 쉽게 통합/배포가 가능한가

### 골디락스 딜레마 

한 번에 처리하는 코드 정리의 크기에 따른 현상

* 많을 때 (한 커밋에 포함?) 
  * 충돌 : merge conflict 가능성 증가, 병합 과정에서의 비용 증가
  * 상호작용 : 코드 정리에 의도치 않은 로직 변경이 들어갈 수 있음
  * 추측 : 다음 변경에 도움이 될 만큼 코드 정리를 하는게 좋은데 코드 정리를 많이 할 경우 다음 코드 정리에 영향받는 범위가 커지기 때문에 더 많은 코드를 다음에 정리하게 됨. 
* 적을 때
  * 검토 비용 (변경 사항 검토 / 배포 고정 비용) 증가

**코드 정리 개수를 늘려 동작 변경 비용 줄이기. 이러면 검토 비용을 줄일 수 있음**

