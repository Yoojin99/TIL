# ë±…í¬ ìƒëŸ¬ë“œ í…ŒìŠ¤íŠ¸ ì‚¬ë¡€

1. ì•± ë‹¨ìœ„ í†µí•© UI í…ŒìŠ¤íŠ¸ : https://blog.banksalad.com/tech/test-in-banksalad-ios-1/
2. í™”ë©´ ë‹¨ìœ„ í†µí•© í…ŒìŠ¤íŠ¸ : https://blog.banksalad.com/tech/test-in-banksalad-ios-2/
3. ìŠ¤í™ë³„ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ : https://blog.banksalad.com/tech/test-in-banksalad-ios-3/

---
ì •ë¦¬

1. í†µí•© UI í…ŒìŠ¤íŠ¸

í†µí•© UI í…ŒìŠ¤íŠ¸ëŠ” êµ¬í˜„ ë°©ì‹(UIKit/SU)ì™€ ìƒê´€ì—†ì´ ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ì—†ì´ ìˆœìˆ˜ í…ŒìŠ¤íŠ¸ ì¶”ê°€ê°€ ê°€ëŠ¥í•¨. ìœ ì§€ë³´ìˆ˜ ë¹„ìš© ë¹„ìŒˆ/ì‹¤ í™˜ê²½ì— ì˜í–¥ ë°›ìŒ ì´ìŠˆë¡œ ëª¨ë“  ê¸°ëŠ¥ì— ì ìš©í•˜ê¸°ëŠ” í˜„ì‹¤ì ìœ¼ë¡œ í˜ë“¤ì§€ë§Œ Unit Test ìì²´ë§Œìœ¼ë¡œëŠ” ë²„ê·¸ê°€ ì—†ìŒì„ ê²€ì¦í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— í•„ìš”í•¨.

* ê¸°ëŒ€ íš¨ê³¼ : Unit Test ë¡œë„ ê²€ì¦ì„ ë‹¤ í•  ìˆ˜ ì—†ëŠ” í•„ìˆ˜ í•µì‹¬ ë¡œì§ ê²€ì¦
* ì„ í–‰ ì‘ì—… : VoiceOver ë¡œë„ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í™˜ê²½ ì¡°ì„±
* ë„ì… : ê°œë°œìë“¤ì´ í…ŒìŠ¤íŠ¸ í¬ë§·ì— ìµìˆ™í•´ì§€ê²Œ í•˜ê¸° ìœ„í•œ LocalUITest ë¼ëŠ” ë„êµ¬ ë„ì…
* ìš´ìš© : Smoke test ë¥¼ github action ìœ¼ë¡œ 4ì‹œê°„ë§ˆë‹¤ í•œ ë²ˆì”© ëŒë¦¬ê³  ì‹¤íŒ¨ì‹œ ê´€ë ¨ ë‚´ìš©ì„ ìŠ¬ë™ìœ¼ë¡œ ë³´ë‚¼ ìˆ˜ ìˆê²Œ í•¨
* í…ŒìŠ¤íŠ¸í•˜ëŠ” í•­ëª©
  * ì¤‘ìš”í•œ í•µì‹¬ ë¡œì§ (ì¥ì• ë‚˜ë©´ í°ì¼ì´ë‹¤ ì‹¶ì€ ë¡œì§)
  * ë¡œê¹…

2. í™”ë©´ ë‹¨ìœ„ í†µí•© í…ŒìŠ¤íŠ¸

í™”ë©´ ë‹¨ìœ„ í†µí•© í…ŒìŠ¤íŠ¸ëŠ” ì •ë‹µì§€(ë””ìì¸ ì‹œì•ˆ) ì´ë¯¸ì§€ì™€ ì½”ë“œë¥¼ í†µí•´ ìƒì„±ëœ í™”ë©´ê³¼ ì™„ì „íˆ ì¼ì¹˜í•˜ëŠ”ì§€ ë¹„êµí•˜ëŠ” í…ŒìŠ¤íŠ¸

* ì¢…ë¥˜
1. Snapshot í…ŒìŠ¤íŠ¸
2. AXSnapshot í…ŒìŠ¤íŠ¸

Snapshot í…ŒìŠ¤íŠ¸

* ë‹¨ì  : ë””ìì¸ ì‹œì•ˆ ê·¸ëŒ€ë¡œ 1í”½ì…€ ì˜¤ì°¨ ì—†ëŠ” í™”ë©´ì„ ê°œë°œí•˜ê¸° ì–´ë µê¸° ë•Œë¬¸ì— TDDê°€ ì–´ë ¤ì›€.
* ì¥ì  : ì›Œí¬ í”Œë¡œìš° ê°œì„ . ì½”ë“œ ìˆ˜ì •í›„ íŠ¹ì • í™”ë©´ ì§„ì…ê¹Œì§€ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ê²½ìš° ê²€ì¦í•˜ê¸° ì˜¤ë˜ ê±¸ë¦¬ëŠ”ë° í…ŒìŠ¤íŠ¸ê°€ ì´ë¥¼ í•´ê²°
* í™œìš©
  * ì˜¤ì°¨ë²”ìœ„ë¥¼ ëŠ˜ë ¤ ë”œë ˆë§ˆë¥¼ íƒˆì¶œ
  * CI ê²€ì¦ í…ŒìŠ¤íŠ¸ë¡œ ì‚¬ìš©í•˜ì§€ ì•Šê³  í…ŒìŠ¤íŠ¸ì˜ ë³´ì¡°ìˆ˜ë‹¨ìœ¼ë¡œ ì‚¬ìš©
  * ë””ìì¸ QA. ì—¬ëŸ¬ ì‹œë‚˜ë¦¬ì˜¤ê°€ ë°œìƒ ê°€ëŠ¥í•  ë•Œ ì‹œë‚˜ë¦¬ì˜¤ë³„ë¡œ í™”ë©´ì„ í…ŒìŠ¤íŠ¸ë¡œ ìƒì„±í•´ì„œ íŒŒì¼ë¡œ ì´ë¯¸ì§€ë¥¼ ì €ì¥í•˜ê³  ë””ìì´ë„ˆ ë¶„ê»˜ ê³µìœ í•  ìˆ˜ ìˆìŒ. ê³µìœ í•´ì„œ ê²€ì¦ë°›ì€ ì´ë¯¸ì§€ëŠ” ì •ë‹µì§€ë¡œ ì‚¬ìš©ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ìœ„ì—ì„œ ì–¸ê¸‰í•œ ë‹¨ì ì„ ìƒì‡„ì‹œí‚¬ ìˆ˜ ìˆìŒ

AXSnapshot í…ŒìŠ¤íŠ¸

UI í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ì ‘ê·¼ì œí•œìë¥¼ ë³€ê²½í•´ì•¼ í•œë‹¤ëŠ” ë‹¨ì ì„ ë³´ì™„í•˜ê¸° ìœ„í•´ ì ‘ê·¼ì„± ìš”ì†Œë¥¼ ì‚¬ìš©í•´ì„œ private í•­ëª©ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤ëŠ” íŠ¹ì„±ì„ ì‚¬ìš©í•´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ê°€ëŠ¥í•˜ê²Œ ë§Œë“  ê¸°ëŠ¥. 
ë±…ì…€ì—ì„œ ë§Œë“  ì˜¤í”ˆì†ŒìŠ¤.

3. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

(ì½”ë“œ ì˜ˆì œê°€ ë§ê¸° ë•Œë¬¸ì— ì½”ë“œë¥¼ ë³´ëŠ” ê²ƒì´ ì¢‹ìŒ)

* í…ŒìŠ¤íŠ¸í•˜ëŠ” í•­ëª©
  * Unit test ê°€ í•„ìš”í•œ ë¶€ë¶„
  * Rx ê¸°ë°˜ ì´ë²¤íŠ¸ ì²˜ë¦¬
  * ë¡œê¹…
  * í™”ë©´ ì „í™˜
* ë°©ë²•
  * ë³„ë„ì˜ í´ë˜ìŠ¤ ìƒì„±í•´ì„œ ë‚´ë¶€ì— given / when / then ë©”ì„œë“œë¥¼ ìƒì„±
  * ì¤‘ìš”í•œ í…ŒìŠ¤íŠ¸ í•­ëª©ì— ëŒ€í•´ ë³„ë„ì˜ í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ ìƒì„±
---

## 1. í†µí•© UI í…ŒìŠ¤íŠ¸

* ì¥ì  : **ë‚´ë¶€ êµ¬í˜„ (UIKit/SwiftUI) ê³¼ ìƒê´€ ì—†ì´, ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ì—†ì´ ìˆœìˆ˜í•˜ê²Œ í…ŒìŠ¤íŠ¸ ì¶”ê°€ê°€ ê°€ëŠ¥**
* ë‹¨ì 
  * **ìœ ì§€ë³´ìˆ˜ ë¹„ìš© ë¹„ìŒˆ**
  * ì‹¤ì œ ì•±ì„ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” í…ŒìŠ¤íŠ¸ëŠ” API ì  ë•Œë„ ì‹¤ì œ ì„œë²„ì— ì¨. ë„¤íŠ¸ì›Œí¬ í™˜ê²½ ë“± **ì‹¤íŒ¨í•  ì—¬ì§€ ë§ê³  ë‹¤ë£¨ê¸° ì–´ë ¤ì›€**
* ì ìš©
  * ë‹¨ì ë“¤ ë•Œë¬¸ì— ëª¨ë“  ê¸°ëŠ¥ì— í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ì ìš©í•˜ëŠ” ê±´ **ë¹„í˜„ì‹¤ì **
  * **ì•„ì£¼ ì¤‘ìš”í•œ í•„ìˆ˜ ê¸°ëŠ¥ì€ í†µí•© UI í…ŒìŠ¤íŠ¸ ì‘ì„±**
* í•„ìš”í•œ ì´ìœ 
  * Unit test ê°ê°ì€ ì„±ê³µí•´ë„ í†µí•© ê³¼ì •ì—ì„œ ë²„ê·¸ê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ

```swift
class testSubmit() {
  ...
  // buttonì„ SwiftUIë¡œ ë§Œë“¤ì—ˆë“ , UIKitìœ¼ë¡œ ë§Œë“¤ì—ˆë“ , 
  // ì•„ë˜ í…ŒìŠ¤íŠ¸ì½”ë“œëŠ” ë™ì‘í•©ë‹ˆë‹¤
  app.buttons["ì œì¶œ"].tap()
  XCTAssert(
    app.navigationBar.staticText["ì œì¶œì™„ë£Œ"].waitForExistence(timeout:10)
  )
}
```

### ì„ í–‰ ì‘ì—…

**VoiceOver ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤ë©´ í…ŒìŠ¤íŠ¸ ì½”ë“œë¡œë„ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.**

í†µí•© UI í…ŒìŠ¤íŠ¸ì—ì„œ ì‹¤ì œë¡œ ë²„íŠ¼ì„ ëˆ„ë¥´ëŠ” UITestRunner ëŠ” ì•±ì—ì„œ ì œê³µí•´ì„œ OSì— ë…¸ì¶œëœ ì ‘ê·¼ì„± íŠ¸ë¦¬ë¥¼ ì°¾ì•„ ì—¬ê¸°ì—ì„œ ìƒí˜¸ì‘ìš©ì„ í•¨.

ì»´í“¨í„°ëŠ” ëˆˆì´ ì—†ê¸° ë•Œë¬¸ì— ì‹œê°ì¥ì• ì¸ì´ ì•±ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒê³¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©. ì¦‰ VoiceOver ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ì•¼ í•¨

### ë„ì…

ë±…ì…€ì—ì„œëŠ” LocalUITest ë¥¼ í†µí•´ UI í…ŒìŠ¤íŠ¸ì— ë¨¼ì € ìµìˆ™í•´ì§. 

LocalUITest ëŠ” UITestì§€ë§Œ gitignore ë˜ëŠ” í…ŒìŠ¤íŠ¸. ì¤‘ìš”í•˜ì§„ ì•Šê³  ê°œë°œìë“¤ì´ í…ŒìŠ¤íŠ¸ í¬ë§·ì„ ìµíˆê¸° ìœ„í•œ ë„êµ¬

* í™œìš© ë°©ì•ˆ
  * íŠ¹ì • ì ‘ê·¼ ë°©ì‹ì—ì„œë§Œ ì¬í˜„ë˜ëŠ” ë²„ê·¸ ì¡ê¸°
  * ì—ëŸ¬ ì¬í˜„ ìŠ¤í… ìë™í™”
  * (ë§¤ë²ˆ ì•±ì„ ì¼œì„œ ì¬í˜„ìŠ¤í…ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì€ ê·€ì°®ìŒ)

### ìš´ìš©

* **Smoke Test(ë±…ì…€ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•œëŠ í†µí•© UI í…ŒìŠ¤íŠ¸) ëŠ” GithubAction ì„ í†µí•´ 4ì‹œê°„ë§ˆë‹¤ í•œ ë²ˆì”© ìˆ˜í–‰**
  * ì‹¤íŒ¨í•œ ê²½ìš° ì‹¤íŒ¨í•œ ì‹œì ì˜ ìŠ¤í¬ë¦°ìƒ·, ê´€ë ¨ ì½”ë“œ ì •ë³´ê°€ í¬í•¨ëœ [resetBundle](https://help.apple.com/xcode/mac/current/#/devc38fc7392) ì´ í¬í•¨ëœ ë§í¬ê°€ ìŠ¬ë™ìœ¼ë¡œ ê³µì§€ë¨. 
* ì „ì œ ì¡°ê±´
  * í•­ìƒ ê°™ì€ ì¢…ë¥˜ì˜ ì‹œë®¬ë ˆì´í„°ì—ì„œ ì‹¤í–‰ë˜ì–´ì•¼ í•¨. ê¸°ê¸°ë³„ë¡œ ì–´ë–¤ í™”ë©´ì—ì„œëŠ” ë°”ë¡œ ë…¸ì¶œë˜ì§€ë§Œ ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œëŠ” ìŠ¤í¬ë¡¤ì„ í•´ì•¼ ë…¸ì¶œë  ìˆ˜ ìˆê¸° ë•Œë¬¸.

```ruby
# getSimulatorMatchingCondition.rb
# ì£¼ì–´ì§„ ì¡°ê±´ì— í•´ë‹¹í•˜ëŠ” ì‹œë®¬ë ˆì´í„°ì˜ ê³ ìœ  IDë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.
require "json"

deviceName = ARGV[0]
runTime = ARGV[1]

json = JSON.parse(%x(xcrun simctl list 'devices' -j))
devices = json["devices"]["com.apple.CoreSimulator.SimRuntime.iOS-#{runTime}"]

if devices == nil
    puts "Error: í•´ë‹¹ OSë¥¼ ë§Œì¡±í•˜ëŠ” ì‹œë®¬ë ˆì´í„°ê°€ ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤"
else
    filteredDevices = devices.filter { |item| item["name"] == deviceName }

    if filteredDevices.empty?
        puts "Error: í•´ë‹¹ ì´ë¦„ì„ ë§Œì¡±í•˜ëŠ” ì‹œë®¬ë ˆì´í„°ê°€ ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤"
    else
        puts filteredDevices[0]["udid"]
    end
end

# ì‚¬ìš©ì˜ˆì‹œ 
# ruby getSimulatorMatchingCondition.rb "iPhone SE (1st generation)" "15-0"
```

ë…¸íŠ¸ë¶ì— node ëŠ” ì•ˆ ê¹”ë ¤ ìˆì–´ë„ ruby ëŠ” í•­ìƒ ì„¤ì¹˜ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ì›¬ë§Œí•´ì„œ ruby ì‚¬ìš©

### ë¡œê¹… í…ŒìŠ¤íŠ¸

ê¸°ëŠ¥ + ë‚¨ê¸°ëŠ” ë¡œê·¸ë“¤ì´ ì˜ ê¸°ë¡ë˜ëŠ”ì§€ë„ í™•ì¸. 

ë¡œê·¸ëŠ” íšŒì‚¬ì—ì„œ ì˜ì‚¬ê²°ì •ì„ í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ì¤‘ìš” ì§€í‘œì´ê¸° ë•Œë¬¸ì— ëˆ„ë½/ì¤‘ë³µ ì—¬ë¶€ê°€ ì¤‘ìš”í•¨.

ë±…ì…€ì—ì„œëŠ” ì•± ë‚´ ê°œë°œìì„¼í„°ì— í•´ë‹¹ ì„¸ì…˜ì—ì„œ ë°œìƒí•œ ë¡œê·¸ë“¤ì„ ëª¨ì•„ì„œ ê²€ìƒ‰í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ë§Œë“¬.

## 2. í™”ë©´ ë‹¨ìœ„ í†µí•© í…ŒìŠ¤íŠ¸

### Snapshot í…ŒìŠ¤íŠ¸

Snapshot í…ŒìŠ¤íŠ¸ëŠ” **í™”ë©´ì´ë¼ëŠ” ì¶œë ¥ë¬¼ì„ í…ŒìŠ¤íŠ¸**í•¨. 

ì£¼ì–´ì§„ ì •ë³´ë¥¼ ì–´ë–»ê²Œ í‘œí˜„í•´ì•¼ í•˜ëŠ”ì§€ **ì •ë‹µì§€ë¡œ 'ë ˆí¼ëŸ°ìŠ¤ ì´ë¯¸ì§€'**ë¥¼ ë¯¸ë¦¬ ìƒì„±í•˜ê³ ,
ì½”ë“œê°€ ê°™ì€ ì •ë³´ë¥¼ ì²˜ë¦¬í–ˆì„ ë•Œ ë ˆí¼ëŸ°ìŠ¤ ì´ë¯¸ì§€ì™€ **í”½ì…€ ë‹¨ìœ„ë¡œ ë¹„êµ**í•˜ëŠ” ê²ƒì´ ì›ë¦¬.

ìœ„ íŠ¹ì„± ë•Œë¬¸ì— **TDD ê°€ ì–´ë µë‹¤. TDD ëŠ” ë””ìì¸ ì‹œì•ˆì„ ë ˆí¼ëŸ°ìŠ¤ ì´ë¯¸ì§€ë¡œ ì‚¬ìš©í•´ì•¼ í•˜ëŠ”ë° ë””ìì¸ ì‹œì•ˆ ê·¸ëŒ€ë¡œ 1í”½ì…€ì˜ ì˜¤ì°¨ ì—†ëŠ” í™”ë©´ì„ ê°œë°œí•˜ê¸° ì–´ë µê¸° ë•Œë¬¸.**

* ì‚¬ì†Œí•œ í”½ì…€ ë”œë ˆë§ˆ
  * í…ŒìŠ¤íŠ¸ ì‘ì„± ë¹„ìš©ì´ ì»¤ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ë¬´ì‹œí•´ì•¼ í•˜ë‚˜? : í…ŒìŠ¤íŠ¸ê°€ ì˜ë¯¸ì—†ì–´ì§
  * í”½ì…€ 1pxê¹Œì§€ ë§ì¶°ì•¼ í•˜ë‚˜? : ë¹„ìš©ì´ ì§€ë‚˜ì¹˜ê²Œ ì»¤ì§

"í—ˆìš©ë²”ìœ„"ë¥¼ ëŠ˜ë ¤ì„œ ë”œë ˆë§ˆë¥¼ íƒˆì¶œ. Snapshot í…ŒìŠ¤íŠ¸ëŠ” CIì—ì„œ ëŒì•„ê°€ëŠ” ê²€ì¦í…ŒìŠ¤íŠ¸ê°€ ì•„ë‹Œ **í…ŒìŠ¤íŠ¸ì˜ ë³´ì¡°ìˆ˜ë‹¨ìœ¼ë¡œ ì‚¬ìš©**í•˜ê¸°.
Snapshot í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ ì›Œí¬ í”Œë¡œìš°ë¥¼ ê°œì„ í•  ìˆ˜ ìˆìŒ.

```
ê¸°ì¡´
âœï¸ ì½”ë“œ ìˆ˜ì • â†’ ğŸ˜ í”„ë¡œì íŠ¸ ì „ì²´ ë¹Œë“œ â†’ ğŸ“± ì•± ì‹¤í–‰ â†’ ğŸ¥¾ ì—¬ëŸ¬ ë²„íŠ¼ì„ í´ë¦­í•´ ë‚´ê°€ ì‘ì—…í•œ í™”ë©´ìœ¼ë¡œ ì´ë™ â†’ ğŸ” í™”ë©´ í™•ì¸

- ìœ„ ë°©ì‹ì€ ì‘ì€ ì½”ë“œ ìˆ˜ì •ì—ë„ ì‹œê°„ì´ ì˜¤ë˜ ì†Œìš”ë¨. íŠ¹íˆ ì‘ì—…í•œ í™”ë©´ê¹Œì§€ ì´ë™í•˜ê¸°ê°€ ì–´ë ¤ìš´ ê²½ìš°.

Snapshot í…ŒìŠ¤íŠ¸ë¥¼ ì´ìš©í•œ ê°œì„ 
âœï¸ ì½”ë“œ ìˆ˜ì • â†’ ğŸ  ëª¨ë“ˆ ë¹Œë“œ â†’ ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹¤í–‰ â†’ ğŸ” í™”ë©´ í™•ì¸

- ì‹¤ì œ í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í•˜ê²Œë” ì‘ì„±í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ breakpoint ë¥¼ ì°ì–´ì„œ í™”ë©´ì„ í™•ì¸í•´ì„œ ì œëŒ€ë¡œ ë°˜ì˜ì´ ëëŠ”ì§€ í™•ì¸í•˜ëŠ” ê²ƒ
https://blog.banksalad.com/20811343c4e88877178d9545f1c3f555/snapshotTestingWorkflow.mov
```

QA ë‹¨ê³„ì—ì„œ ì‹œë‚˜ë¦¬ì˜¤ë³„ë¡œ í™”ë©´ì´ ì˜ ê·¸ë ¤ì§€ëŠ”ì§€ë¥¼ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê³ ,
ìƒì„±ëœ ì´ë¯¸ì§€ë“¤ì„ XCTest ì˜ ì²¨ë¶€íŒŒì¼ë¡œ ë§Œë“¤ì–´ì„œ resultBundle ë¡œ ê´€ë¦¬í•´ì„œ ê³µìœ í•˜ë©´ ë¨.

```swift
/// ì¹´ë“œì„¹ì…˜ì„ ê°œë°œí•  ë•Œ ì“°ëŠ” í…ŒìŠ¤íŠ¸ì½”ë“œ 
func testCardSectionView() async throws {
  // Given
  var data = CardSectionData()

  // When
  let view = CardSectionView(with: data)

  // Then
  let screenshot = view.screenshot()
  // ì´ ë¼ì¸ì— breakPointë¥¼ ê±¸ë©´, `screenshot` ë³€ìˆ˜ì— ì´ë¯¸ì§€ê°€ ì–´ë–»ê²Œ ë“¤ì–´ê°”ëŠ”ì§€ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

  // ë§Œë“¤ì–´ì§„ ìŠ¤ìƒ·ë“¤ì„ ì´ í…ŒìŠ¤íŠ¸ì˜ ì²¨ë¶€íŒŒì¼ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤
  let attachment = XCTAttacment(image: screenshot)
  attachment.lifetime = .keepAlways
  self.add(attachment)
} 
```

ì•„ë˜ì™€ ê°™ì´ ë§Œë“¤ì–´ì„œ ê³µìœ í•  ìˆ˜ ìˆëŠ”ë°, ê°œì¸ì ì¸ ìƒê°ìœ¼ë¡œëŠ” ê²°êµ­ QA ëŠ” ì™„ì „íˆ ëŒ€ì²´í•˜ëŠ” ê²ƒì€ ì–´ë ¤ìš¸ ê²ƒ ê°™ìŒ. 
ì‹œë‚˜ë¦¬ì˜¤ê°€ ë§ì€ ê²½ìš° ë””ìì´ë„ˆ ë¶„ë“¤ê»˜ í™•ì¸ ìš©ìœ¼ë¡œ í•œ ë²ˆ ê²€ì¦ë°›ê¸° ìœ„í•œ ìš©ë„ë¡œëŠ” ìœ ìš©í•  ë“¯

```sh
# runSnapshotTest.sh

# ìœ„ì™€ ê°™ì€ í…ŒìŠ¤íŠ¸ì½”ë“œë¥¼ ì‹¤í–‰ì‹œí‚¤ê³ , 
# ê·¸ ê²°ê³¼ë¬¼ì¸ ìŠ¤í¬ë¦°ìƒ·ë“¤ì„ ë½‘ì•„ë‚´ì–´ í´ë”ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.

xcodebuild -workspace banksalad.xcworkspace \ 
  -scheme LocalAssetSnapshot \ 	# í˜„ì¬ ê°œë°œì¤‘ì¸ í™”ë©´ë“¤ë§Œ í…ŒìŠ¤íŠ¸í•˜ëŠ”, ê·¸ ë‚´ìš©ë¬¼ì€ gitignoreë˜ëŠ” schemeì„ ë”°ë¡œ ë§Œë“­ë‹ˆë‹¤. 
  -sdk iphonesimulator \
  -destination "platform=iOS Simulator,name=iPhone SE (1st generation)" \
  -destination 'platform=iOS Simulator,name=iPhone 13 Pro Max' \
  -derivedDataPath build/ \
  -resultBundlePath resultBundle \ # í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ resultBundleê²½ë¡œì— ì €ì¥í•©ë‹ˆë‹¤.
  test

xcparse screenshots \ # í…ŒìŠ¤íŠ¸ ê²°ê³¼ì—ì„œ screenshotë“¤ë§Œ parseí•©ë‹ˆë‹¤
   --test-plan-config \ # ì´ ë•Œ, test-planê³¼, í…ŒìŠ¤íŠ¸ê°€ ì‹¤í–‰ëœ ê¸°ê¸° ê¸°ì¤€ìœ¼ë¡œ í´ë”ë¥¼ ë‚˜ëˆ•ë‹ˆë‹¤.
   --model \
   resultBundle.xcresult \
   screenshotOutput # parseëœ ê²°ê³¼ë¥¼ screenshotOutput í´ë”ì— ì €ì¥í•©ë‹ˆë‹¤.
```

ë˜í•œ ìœ„ì—ì„œ ìƒì„±í•œ ì´ë¯¸ì§€ë¡œ ë””ìì¸ ê²€ì¦ì„ ë§ˆì¹˜ë©´ ì´ê²ƒì´ ë ˆí¼ëŸ°ìŠ¤ ì´ë¯¸ì§€ê°€ ë˜ì–´ ì‚¬ì†Œí•œ í”½ì…€ ë”œë ˆë§ˆë¥¼ í•´ê²°í•˜ê³ , ìŠ¤ëƒ…ìƒ· í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŒ.

Snapshot í…ŒìŠ¤íŠ¸ëŠ” ë¬¸ì„œë¡œì„œì˜ ê¸°ëŠ¥ìœ¼ í•˜ì§€ ëª»í•¨. ì¶œë ¥ë¬¼ì´ íŒŒì¼ë¡œ ì €ì¥ë˜ê¸° ë•Œë¬¸ì— ì½”ë“œë§Œ ì½ì–´ì„œëŠ” ì¶œë ¥ë¬¼ì´ ì–´ë–¤ í˜•íƒœì¸ì§€ ì•Œ ìˆ˜ ì—†ìŒ.

### AXSnapshot í…ŒìŠ¤íŠ¸

í”í•œ ì¼€ì´ìŠ¤ : "ì£¼ì–´ì§„ ì¡°ê±´ì—ì„œ í™”ë©´ì— ì›í•˜ëŠ” ì •ë³´ê°€ ì œëŒ€ë¡œ ì¶œë ¥ë˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ViewModel ì„ í…ŒìŠ¤íŠ¸í•˜ë¼! ViewModel ì´ í…ŒìŠ¤íŠ¸ì— í†µê³¼í•œë‹¤ë©´ View ì™€ ì œëŒ€ë¡œ ì—°ê²°ë˜ì–´ ìˆë‹¤ëŠ” ê°€ì •í•˜ì— View ì— ì¶œë ¥ì´ ê·¸ëŒ€ë¡œ ë°˜ì˜ë  ê²ƒì´ë‹¤."

ë±…ì…€ì€ ViewModel ì´ ì „ë‹¬í•œ ì •ë³´ëŠ” ì–´ë–»ê²Œë“  Viewì— ë‚¨ì•„ ìˆì–´ì„œ ê·¸ ì •ë³´ë¥¼ ê²€ì‚¬í•´ì„œ ì›í•˜ëŠ” ì •ë³´ê°€ ì˜ ì¶œë ¥ë˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆë‹¤ê³  ìƒê°.

```swift
class CardListAndTimelineSectionViewTest: XCTestCase {
    func testë³´ìœ í•œ_ì¹´ë“œ_ì¢…ë¥˜ê°€_4ê°œ_ì´ìƒì¸_ê²½ìš°() {
        // Given
        var cardSection = V1_Financialasset_CardSection()
        cardSection.cards = ë³´ìœ í•œ_ì¹´ë“œ_ì¢…ë¥˜ê°€_4ê°œ_ì´ìƒì¸_ê²½ìš°()

        // When
        let viewModel = CardListAndTimelineSectionViewModel(in: cardSection)
        let view = CardListAndTimeLineView(with: viewModel)

        // Then
        // Viewì˜ ì†ì„±ì„ ê²€ì‚¬í•˜ë ¤ë©´, ì´ì²˜ëŸ¼ ì ‘ê·¼ì œí•œìë¥¼ ë§ì´ í’€ì–´ì•¼ë§Œ í•©ë‹ˆë‹¤.
        XCTAssert(view.extraCardView.amountView.label.text == "40,000ì›")
    }
}
```

ìœ„ì™€ ê°™ì´ view ë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ ì ‘ê·¼ ì œí•œìë¥¼ ë§ì´ í’€ì–´ì•¼ í•˜ëŠ”ë° ì´ë¶€ë¶„ì´ ê±¸ë ¤ì„œ view ë¥¼ í…ŒìŠ¤íŠ¸í•˜ì§€ ì•ŠìŒ.

ì ‘ê·¼ ì œí•œìë¥¼ ìˆ˜ì •í•˜ì§€ ì•Šê³ ë„ ì ‘ê·¼ì„± ì†ì„±ë“¤ì„ í†µí•´ view ì— ì œê³µí•œ ì •ë³´ê°€ ì˜ ë“¤ì–´ê°€ ìˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŒ. 
AssistiveTechnology ì—ì„œëŠ” ë³µì¡í•œ í™”ë©´ ë‚´ ìš”ì†Œë“¤ë„ "ì ‘ê·¼ì„± ì†ì„±ë“¤ ëª¨ìŒì˜ ì¼ì°¨ì› ë°°ì—´"ë¡œ ë³´ì„.

## 3. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

### BaseTestCase

```swift
open class BaseTestCase: XCTestCase {
    /// ì´ˆê¸°ì— ì£¼ì…ë°›ì•„ì•¼ í•  ë°ì´í„°ë¥¼ ì§€ì •í•©ë‹ˆë‹¤
    open func given(_ task: () -> Void) {
        task()
    }

    /// ë°œìƒí•´ì•¼ í•  ì´ë²¤íŠ¸, ë˜ëŠ” ë©”ì†Œë“œ í˜¸ì¶œë“±ì„ ì‹¤í–‰ì‹œí‚µë‹ˆë‹¤
    open func when(_ task: () -> Void) {
        task()
    }

    /// ê²°ê³¼ ê°’ì´ ê¸°ëŒ€ì™€ ê°™ì€ì§€ í™•ì¸í•©ë‹ˆë‹¤
    open func then(_ task: () -> Void) {
        task()
    }
}
```

given, when, then ì„¸ ê°€ì§€ í•¨ìˆ˜

### RxTestCase

BaseTestCase ë¥¼ ìƒì†í•¨. ë±…ì…€ì€ ëŒ€ë¶€ë¶„ì˜ ë¹„ë™ê¸° ë¡œì§ì„ RxSwift ë¡œ ì²˜ë¦¬í•˜ê¸° ë•Œë¬¸ì— Rx ì…ì¶œë ¥ í™•ì¸

```swift
/// Rxë¡œ ë§Œë“¤ì–´ì§„ ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤
open class RxTestCase<T>: BaseTestCase {
    open var scheduler: TestScheduler!
    open var disposeBag: DisposeBag!
    private var resultObserver: TestableObserver<T>!

    /// ì´ TestCaseì—ì„œ ê´€ì¸¡í•˜ê³ ì í•˜ëŠ” ëŒ€ìƒì„ ì„¤ì •í•©ë‹ˆë‹¤.
    open var eventsToObserve: Observable<T> = .empty() {
        didSet {
            disposeBag = DisposeBag()
            scheduler = TestScheduler(initialClock: 0)
            resultObserver = scheduler.createObserver(T.self)
            eventsToObserve.bind(to: resultObserver).disposed(by: disposeBag)
        }
    }

    open func when(observing events: Observable<T>, _ task: () -> Void) {
        self.eventsToObserve = events
        task()
        executeEvents()
    }

    // ì´ í…ŒìŠ¤íŠ¸ì—ì„œ ì²˜ë¦¬í•´ì•¼ í•  ì…ë ¥ì„ í¸í•˜ê²Œ ìƒì„±í•˜ë„ë¡ í•©ë‹ˆë‹¤.
    open func createEvents<U>(_ events: [Recorded<Event<U>>], to relay: PublishRelay<U>) {
        scheduler.createHotObservable(events)
            .bind(to: relay)
            .disposed(by: disposeBag)
    }

    open func createEvents<U>(_ events: [Recorded<Event<U>>], to subject: PublishSubject<U>) {
        scheduler.createHotObservable(events)
            .bind(to: subject)
            .disposed(by: disposeBag)
    }

    open func executeEvents(advanceTo futureTime: VirtualTimeScheduler<TestSchedulerVirtualTimeConverter>.VirtualTime = 10) {
        scheduler.start()
        scheduler.advanceTo(futureTime)
        scheduler.stop()
    }

    /// í…ŒìŠ¤íŠ¸ì˜ ê²°ê³¼. í…ŒìŠ¤íŠ¸ì˜ ë§ˆì§€ë§‰ì—ëŠ” , ì´ ê°’ì— ê¸°ëŒ€í•œ ê°’ì´ ë“¤ì–´ìˆëŠ”ì§€ í™•ì¸í•œë‹¤.
    open var resultEvents: [Recorded<Event<T>>] {
        resultObserver.events
    }
}
```

`when(observing:)` ë©”ì„œë“œì˜ ë§¤ê°œë³€ìˆ˜ì— observer ë¥¼ ì „ë‹¬í•˜ë©° observer ì˜ ì´ë²¤íŠ¸ë“¤ì€ resultEvents ì— ìŒ“ì„.
`then` ì—ì„œ ì´ë²¤íŠ¸ë“¤ì„ í™•ì¸í•  ìˆ˜ ìˆìŒ.

```swift
class SampleRxTestCase: RxTestCase<String> {

    func testë²„íŠ¼í•˜ë‚˜ë§Œ_ëˆ„ë¥´ë©´_ë™ì‘_ì•ˆí•¨() {
        given {
            viewModel = SampleViewModel(data: "Hello")
        }

        when(observing: viewModel.log) {
            createEvents([.next(0, Void())], to: viewModel.aButtonClicked)
        }

        then {
            XCTAssert(resultEvents.isEmpty)
        }
    }

    func testë²„íŠ¼_ë‘ê°œë¥¼_ëˆŒëŸ¬ì•¼_ë™ì‘í•¨() {
        given {
            viewModel = SampleViewModel(data: "World")
        }

        when(observing: viewModel.log) {
            createEvents([.next(0, Void())], to: viewModel.aButtonClicked)
            createEvents([.next(1, Void())], to: viewModel.bButtonClicked)
        }

        then {
            XCTAssert(resultEvents == [.next(1, "World")])
        }
    }
} 
```

ìœ„ ì½”ë“œì™€ ê°™ì´ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ëª…ì‹œì ìœ¼ë¡œ given/when/then ìœ¼ë¡œ ë‚˜ëˆ  ì‘ì„±í•¨.

* ìœ„ì™€ ê°™ì´ ì‘ì„±í–ˆì„ ë•Œ ì¥ì 
  * ì…ì¶œë ¥ì´ ëª…í™•í•´ì„œ ê°€ë…ì„± í–¥ìƒë¨
  * Rx í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±ì‹œ scheduler ê´€ë ¨ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œ ì¤Œ

### EventLoggingTestCase

ë¡œê¹…ì€ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¡œ 100% ê²€ì¦ë˜ì–´ì•¼ í•˜ëŠ” ìŠ¤í™. ìœ¡ì•ˆìœ¼ë¡œ í™•ì¸í•˜ê¸° ì–´ë µê¸° ë•Œë¬¸ì— ì˜ì‹ì ìœ¼ë¡œ í™•ì¸í•˜ì§€ ì•ŠëŠ” ì´ìƒ ë¬¸ì œ ë°œìƒì‹œ ì¸ì§€í•˜ê¸°ê¹Œì§€ ì˜¤ë˜ ê±¸ë¦¼.

ë±…ì…€ì—ì„œëŠ” `EventLogger` ë¥¼ í™œìš©.

```swift
open class EventLoggingTestCase: RxTestCase<(name: String, properties: [String: Any]?)> {
    open override func setUpWithError() throws {
        try super.setUpWithError()
        EventLogger.eventObserver = PublishSubject<(name: String, properties: [String: Any]?)>()
    }

    open override func when(_ task: () -> Void) {
        eventsToObserve = EventLogger.eventObserver
        task()
        executeEvents()
    }
}
```

* `RxTestCase` ë¡œ ì¶©ë¶„íˆ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ê²ƒì„ `EventLoggingTestCase`ë¡œ ë³„ë„ë¡œ ëº€ ì´ìœ 
  * ë¡œê·¸ í…ŒìŠ¤íŠ¸ì˜ ì¤‘ìš”ì„±ì„ í”„ë¡œì íŠ¸ ì°¨ì›ì—ì„œ ê°•ì¡°
  * í´ë˜ìŠ¤ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰í•˜ë©´ ê´€ë ¨ ì˜ˆì œë¥¼ ì‚¬ëŒë“¤ì´ ì°¾ì•„ë³´ê³  í•™ìŠµ ê°€ëŠ¥

#### PresentationTestCase

í™”ë©´ ì „í™˜ ë¡œì§ì€ ë„¤ì´í‹°ë¸Œì—ì„œ ë‹´ë‹¹í•´ì•¼ í•˜ëŠ” ë¡œì§ì„ í†µí•© í…ŒìŠ¤íŠ¸í•˜ê¸° ì¢‹ì€ ì§€ì .

e.g. íŠ¹ì • í™”ë©´ì—ì„œ í¼ì„ ë‹¤ ì±„ì›Œì•¼ ë‹¤ìŒ í™”ë©´ìœ¼ë¡œ ë„˜ì–´ê°ˆ ìˆ˜ ìˆë‹¤ë©´ í¼ ì „ì²´ë¥¼ í•˜ë‚˜ì˜ input, í™”ë©´ ì „í™˜ ì—¬ë¶€ë¥¼ output ìœ¼ë¡œ ì„¤ì •í•˜ë©´ 
ê° í¼ì— ê´€í•œ ë¡œì§ê¹Œì§€ í•œ ë²ˆì— í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŒ.

```swift
open class PresentableLogicTestCase: RxTestCase<Presentable> {
    open var resultPresentableEvents: [Recorded<Event<String?>>] {
        resultEvents.map { event in
            guard let element = event.value.element,
                let description = (element as? CustomDebugStringConvertible)?.debugDescription else {
                return Recorded<Event<String?>>.next(event.time, nil)
            }
            return Recorded<Event<String?>>.next(event.time, description)
        }
    }
}
```

ë±…ì…€ì—ì„œëŠ” ëª¨ë“  í™”ë©´ì„ enum ìœ¼ë¡œ ê´€ë¦¬í•˜ê³  ìˆìŒ. output ì¸ enum ê°’ë“¤ì„ ë¹„êµí•˜ê¸° ìœ„í•´ `debugDescription` ì„ ì„ ì–¸í•´ì„œ ë¹„êµí•¨.
ì´ ì •ë³´ì—ëŠ” ê·¸ í™”ë©´ì—ì„œ í‘œí˜„í•˜ëŠ” ê²ƒì— ëŒ€í•œ ì‹ë³„ìê°€ í¬í•¨ë  ìˆ˜ ìˆìŒ.

```swift
extension PresentableView: CustomDebugStringConvertible {
    public var debugDescription: String {
        switch self {
        case let .cardSectionDetail(section):
            return "cardSectionDetail for section.\(section.id)"
        }
    }
}
```

```swift
class SamplePushableTestCase: PushableLogicTestCase {

    func testì´ë¦„ì…ë ¥í•˜ê³ _ì œì¶œë²„íŠ¼_ëˆ„ë¥´ë©´_ë””í…Œì¼í™”ë©´_í‘¸ì‹œ() {
        given {
            viewModel = SampleViewModel(data: "Hello")
        }

        when {
            createEvents([.next(0, "MyName")], to: viewModel.textEdited)
            createEvents([.next(0, Void())], to: viewModel.submitButtonClicked)
        }

        then {
            XCTAssert(resultPushableEvents == [.next(0, "detailView titled Hello")])
        }
    }

    func testì´ë¦„ì…ë ¥_ì•ˆí•˜ê³ _ì œì¶œë²„íŠ¼_ëˆ„ë¥´ë©´_í™”ë©´ì´ë™_ì•ˆ_í•¨() {
        given {
            viewModel = SampleViewModel(data: "Hello")
        }

        when {
            createEvents([.next(0, Void())], to: viewModel.submitButtonClicked)
        }

        then {
            XCTAssert(resultPushableEvents.isEmpty)
        }
    }
}
```



